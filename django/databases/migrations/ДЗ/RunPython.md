`RunPython` ‚Äî —ç—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏—è –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ Django, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç **–≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π Python-–∫–æ–¥** –≤–æ –≤—Ä–µ–º—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è (–∏–ª–∏ –æ—Ç–∫–∞—Ç–∞) –º–∏–≥—Ä–∞—Ü–∏–∏.

### üîß –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

`RunPython` ‚Äî –æ–ø–µ—Ä–∞—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è **–∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ Python-–∫–æ–¥–∞** –≤ –º–∏–≥—Ä–∞—Ü–∏–∏:

- –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ/–∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö,
- –≤—ã–∑–æ–≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏,
- –ª—é–±—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, —Ç—Ä–µ–±—É—é—â–∏–µ ORM –∏–ª–∏ Python, –Ω–æ **–Ω–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã**.
---
### –ê—Ä–≥—É–º–µ–Ω—Ç—ã
```python
migrations.RunPython(
    code,           # —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏
    reverse_code=None,  # —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏ –æ—Ç–∫–∞—Ç–µ (–∏–Ω–∞—á–µ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ–æ–±—Ä–∞—Ç–∏–º–∞)
    atomic=None,    # —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π
    elidable=False, # —É–¥–∞–ª—è—Ç—å –ª–∏ –ø—Ä–∏ squashing
    hints=None      # –¥–ª—è router'–æ–≤ (—Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
)
```
### ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

1. **–ò—Å–ø–æ–ª—å–∑—É–π `apps.get_model()`**  
    –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π –º–æ–¥–µ–ª–∏ –Ω–∞–ø—Ä—è–º—É—é ‚Äî –ø–æ–ª—É—á–∏ –∏—Ö –∏–∑ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–µ—Å—Ç—Ä–∞:
```python
Country = apps.get_model("myapp", "Country")
```
2. **–£–∫–∞–∑—ã–≤–∞–π `db_alias`**  
–ß—Ç–æ–±—ã –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–ª —Å –ª—é–±–æ–π –ë–î (–Ω–µ —Ç–æ–ª—å–∫–æ default):
```python
db_alias = schema_editor.connection.alias
Country.objects.using(db_alias).bulk_create([...])
```
3. **–ü–∏—à–∏ `reverse_code`**, –µ—Å–ª–∏ –æ—Ç–∫–∞—Ç –≤–æ–∑–º–æ–∂–µ–Ω –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π `RunPython.noop` –¥–ª—è –ø—É—Å—Ç–æ–≥–æ –æ—Ç–∫–∞—Ç–∞:
```python
migrations.RunPython(forwards_func, migrations.RunPython.noop)
```
### ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã

- **–ö–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Ç–æ–¥—ã –º–æ–¥–µ–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç**: `save()`, `__init__()`, `clean()` ‚Äî –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è.
- **–ù–µ –º–µ–Ω—è–π —Å—Ö–µ–º—É –≤–Ω—É—Ç—Ä–∏ `RunPython`** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ `schema_editor`):  
    ‚Üí –≠—Ç–æ –Ω–∞—Ä—É—à–∏—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Å ORM –∏ —Å–ª–æ–º–∞–µ—Ç –∞–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç–æ—Ä –º–∏–≥—Ä–∞—Ü–∏–π.  
    ‚Üí –ï—Å–ª–∏ –≤—Å—ë –∂–µ –Ω—É–∂–Ω–æ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π `SeparateDatabaseAndState`.
- **–ù–∞ PostgreSQL/SQLite**: `RunPython` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–≤ —Ç–æ–π –∂–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —á—Ç–æ –∏ –≤—Å—è –º–∏–≥—Ä–∞—Ü–∏—è**.  
    ‚Üí –ù–µ —Å–º–µ—à–∏–≤–∞–π `RunPython` –∏ DDL-–æ–ø–µ—Ä–∞—Ü–∏–∏ (ALTER, DROP) –≤ –æ–¥–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ ‚Äî –≤–æ–∑–º–æ–∂–Ω–∞ –æ—à–∏–±–∫–∞ `pending trigger events`.
- **–ù–∞ MySQL/Oracle**: –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é **–Ω–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è DDL**, –Ω–æ `RunPython` –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—ë—Ä–Ω—É—Ç –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.  
    ‚Üí –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å `schema_editor` ‚Äî –ø–µ—Ä–µ–¥–∞–π `atomic=False`.
### –ü—Ä–∏–º–µ—Ä: –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
```python
def create_countries(apps, schema_editor):
    Country = apps.get_model("core", "Country")
    db_alias = schema_editor.connection.alias
    Country.objects.using(db_alias).bulk_create([
        Country(name="Germany", code="de"),
        Country(name="Japan", code="jp"),
    ])

def delete_countries(apps, schema_editor):
    Country = apps.get_model("core", "Country")
    db_alias = schema_editor.connection.alias
    Country.objects.using(db_alias).filter(code__in=["de", "jp"]).delete()

class Migration(migrations.Migration):
    dependencies = [("core", "0001_initial")]
    operations = [
        migrations.RunPython(create_countries, delete_countries),
    ]
```
### üßπ `elidable=True`

–ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è **—á–∏—Å—Ç–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–æ–Ω–Ω–∞—è** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–∑–¥–∞—ë—Ç –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ), –∏ –≤—ã –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –≤ –±—É–¥—É—â–µ–º –¥–µ–ª–∞—Ç—å `squashmigrations` ‚Äî —É–∫–∞–∂–∏—Ç–µ:
```python
migrations.RunPython(forwards_func, elidable=True)
```
‚Üí –ü—Ä–∏ squashing —Ç–∞–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–µ–Ω–∞**.

---

### üìå –ó–∞—á–µ–º –Ω—É–∂–µ–Ω

–î–ª—è **data migrations** ‚Äî –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –Ω–µ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î, –∞:

- –∑–∞–ø–æ–ª–Ω–∏—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ,
- –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—è –≤ –¥—Ä—É–≥–æ–µ,
- –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∑–∞–ø–∏—Å–∏ –ø–æ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–µ.
### –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
```python
# myapp/migrations/0002_data.py
from django.db import migrations

def forwards(apps, schema_editor):
    Book = apps.get_model("myapp", "Book")
    for book in Book.objects.all():
        book.slug = book.title.lower().replace(" ", "-")
        book.save()

def backwards(apps, schema_editor):
    Book = apps.get_model("myapp", "Book")
    Book.objects.update(slug="")

class Migration(migrations.Migration):
    dependencies = [("myapp", "0001_initial")]
    operations = [
        migrations.RunPython(forwards, reverse_code=backwards),
    ]
```
### üîë –í–∞–∂–Ω—ã–µ –¥–µ—Ç–∞–ª–∏

1. **`apps.get_model()`** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ –∏–º–ø–æ—Ä—Ç–∞ –º–æ–¥–µ–ª–∏ –Ω–∞–ø—Ä—è–º—É—é.  
    ‚Üí –î–∞—ë—Ç **—Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–¥–µ–ª–∏ –Ω–∞ –º–æ–º–µ–Ω—Ç –º–∏–≥—Ä–∞—Ü–∏–∏**, –∞ –Ω–µ —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –∏–∑ `models.py`.
2. **`schema_editor`** ‚Äî –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å ¬´—Å—ã—Ä—ã–µ¬ª SQL-–æ–ø–µ—Ä–∞—Ü–∏–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ (—Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `RunPython`).
3. **–û–±—Ä–∞—Ç–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è (`reverse_code`)** ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã –º–∏–≥—Ä–∞—Ü–∏—è –±—ã–ª–∞ **–æ—Ç–∫–∞—Ç—ã–≤–∞–µ–º–æ–π**.  
    ‚Üí –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞—Ç—å ‚Äî –º–∏–≥—Ä–∞—Ü–∏—è —Å—Ç–∞–Ω–µ—Ç **–Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ–π**.
4. **–ù–µ –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î** ‚Äî –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π `RunPython` –≤–º–µ—Å—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤—Ä–æ–¥–µ `AddField`, `RenameModel` –∏ —Ç.–¥.

---

### ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ `atomic = False` –º–∏–≥—Ä–∞—Ü–∏—è—Ö —Å `transaction.atomic()` –≤–Ω—É—Ç—Ä–∏ –±–µ–∑ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏.
- –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–¥.
- –î–æ–ª–∂–µ–Ω –±—ã—Ç—å **–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º** –∏–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É –∑–∞–ø—É—Å–∫—É (–Ω–∞ —Å–ª—É—á–∞–π —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞).

---

### ‚úÖ –ò—Ç–æ–≥

`RunPython` ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è **–º–∏–≥—Ä–∞—Ü–∏–π –¥–∞–Ω–Ω—ã—Ö**, –∞ –Ω–µ —Å—Ö–µ–º—ã.  
–ü–∏—à–∏ —á–∏—Å—Ç–æ, –∏—Å–ø–æ–ª—å–∑—É–π `apps.get_model()`, –∏ –≤—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–π `reverse_code`, –µ—Å–ª–∏ –æ—Ç–∫–∞—Ç –≤–æ–∑–º–æ–∂–µ–Ω.
- `RunPython` ‚Äî –¥–ª—è **–¥–∞–Ω–Ω—ã—Ö**, –Ω–µ –¥–ª—è —Å—Ö–µ–º—ã.
- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π `apps.get_model()` –∏ `using(db_alias)`.
- –í—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π –º–∏–≥—Ä–∞—Ü–∏—é –æ–±—Ä–∞—Ç–∏–º–æ–π, –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ.
- –ù–µ —Å–æ–≤–º–µ—â–∞–π —Å DDL –≤ –æ–¥–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ PostgreSQL.
- –ü–∏—à–∏ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é ‚Äî —Ç–∞–∫ —á–∏—â–µ –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–µ–µ.