### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

`RunSQL` ‚Äî –æ–ø–µ—Ä–∞—Ü–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è **–ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ SQL** –≤ –º–∏–≥—Ä–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ Django –Ω–µ –ø–æ–¥—Ö–æ–¥—è—Ç:

- —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –æ–ø—Ü–∏—è–º–∏,
- –≤—ã–∑–æ–≤ —Ö—Ä–∞–Ω–∏–º—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä,
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —Ñ–∏—á –°–£–ë–î (–Ω–∞–ø—Ä–∏–º–µ—Ä, `GIN` –≤ PostgreSQL).
### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
```python
migrations.RunSQL(
    sql,                # SQL –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏
    reverse_sql=None,   # SQL –ø—Ä–∏ –æ—Ç–∫–∞—Ç–µ (–∏–Ω–∞—á–µ ‚Äî –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ)
    state_operations=None,  # –∫–∞–∫ —ç—Ç–∞ SQL-–æ–ø–µ—Ä–∞—Ü–∏—è –≤–ª–∏—è–µ—Ç –Ω–∞ –º–æ–¥–µ–ª—å (–¥–ª—è –∞–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç–æ—Ä–∞)
    elidable=False,     # —É–¥–∞–ª—è—Ç—å –ª–∏ –ø—Ä–∏ squashing
    hints=None          # –¥–ª—è —Ä–æ—É—Ç–µ—Ä–æ–≤ (—Ä–µ–¥–∫–æ)
)
```
### ‚úÖ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

#### 1. –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å
```python
migrations.RunSQL("CREATE INDEX CONCURRENTLY idx_name ON book (title);")
```
#### 2. –° –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (–±–µ–∑–æ–ø–∞—Å–Ω–æ –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π)
```python
migrations.RunSQL([
    ("INSERT INTO tag (name) VALUES (%s);", ["Python"])
])
```
#### 3. –û–±—Ä–∞—Ç–∏–º–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è
```python
migrations.RunSQL(
    sql="INSERT INTO status (code) VALUES ('active');",
    reverse_sql="DELETE FROM status WHERE code = 'active';"
)
```
#### 4. –ü—É—Å—Ç–æ–π –æ—Ç–∫–∞—Ç (–µ—Å–ª–∏ –æ—Ç–∫–∞—Ç –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω, –Ω–æ –Ω—É–∂–Ω–æ –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–∫–∏)
```python
migrations.RunSQL(
    sql="SOME IRREVERSIBLE SQL",
    reverse_sql=migrations.RunSQL.noop
)
```
### ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

#### üî∏ **`state_operations` ‚Äî –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω**

–ï—Å–ª–∏ –≤–∞—à SQL **–º–µ–Ω—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ALTER TABLE ADD COLUMN`), –∞–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç–æ—Ä –º–∏–≥—Ä–∞—Ü–∏–π **–Ω–µ —É–∑–Ω–∞–µ—Ç –æ–± —ç—Ç–æ–º**, –∏ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º `makemigrations` –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ **–µ—â—ë —Ä–∞–∑**.
```python
migrations.RunSQL(
    "ALTER TABLE book ADD COLUMN slug VARCHAR(50);",
    state_operations=[
        migrations.AddField("book", "slug", models.CharField(max_length=50))
    ]
)
```
‚Üí Django –æ–±–Ω–æ–≤–∏—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–¥–µ–ª–∏, –∏ –∞–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç–æ—Ä –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∂–Ω–æ.

#### üî∏ **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**

- **PostgreSQL / SQLite**: –º–∏–≥—Ä–∞—Ü–∏–∏ **–∞—Ç–æ–º–∞—Ä–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**.  
    ‚Üí **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `BEGIN`/`COMMIT`** –≤–Ω—É—Ç—Ä–∏ SQL ‚Äî —ç—Ç–æ —Å–ª–æ–º–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é Django.
- **MySQL / Oracle**: DDL –Ω–µ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö ‚Üí `RunSQL` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å.

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±–æ–π—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Äî —Å–¥–µ–ª–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é **–Ω–µ–∞—Ç–æ–º–∞—Ä–Ω–æ–π**:
```python
class Migration(migrations.Migration):
    atomic = False
    operations = [migrations.RunSQL("...")]
```
#### üî∏ **PostgreSQL: `CONCURRENTLY` –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**

–û–ø–µ—Ä–∞—Ü–∏–∏ –≤—Ä–æ–¥–µ `CREATE INDEX CONCURRENTLY` **–Ω–µ–ª—å–∑ embroidery –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**.  
‚Üí –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `atomic = False`.
### –ü—Ä–∏–º–µ—Ä: –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ —á–µ—Ä–µ–∑ SQL
```python
class Migration(migrations.Migration):
    atomic = False  # –µ—Å–ª–∏ –Ω—É–∂–Ω–æ CONCURRENTLY –∏–ª–∏ –¥—Ä—É–≥–∏–µ –Ω–µ—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
    dependencies = [("app", "0001_initial")]
    operations = [
        migrations.RunSQL(
            "ALTER TABLE product ADD COLUMN ean VARCHAR(13) DEFAULT '';",
            reverse_sql="ALTER TABLE product DROP COLUMN ean;",
            state_operations=[
                migrations.AddField(
                    "product",
                    "ean",
                    models.CharField(max_length=13, default="")
                )
            ]
        )
    ]
```
### üßπ `elidable=True`

–ï—Å–ª–∏ SQL-–æ–ø–µ—Ä–∞—Ü–∏—è **–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∏–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–æ–Ω–Ω–∞—è**, –∏ –≤—ã –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ squashing:
```python
migrations.RunSQL("...", elidable=True)
```
‚Üí –ë—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∞ –ø—Ä–∏ `squashmigrations`.
### ‚úÖ –ò—Ç–æ–≥

- –ò—Å–ø–æ–ª—å–∑—É–π `RunSQL` **—Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏**.
- –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π `state_operations` –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ö–µ–º—ã.
- –î–µ–ª–∞–π –º–∏–≥—Ä–∞—Ü–∏—é –æ–±—Ä–∞—Ç–∏–º–æ–π (`reverse_sql`) –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π `RunSQL.noop`.
- –ù–∞ PostgreSQL ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π `atomic = False` –¥–ª—è –Ω–µ—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥.
- –ù–µ –≤—Å—Ç–∞–≤–ª—è–π `BEGIN`/`COMMIT` –≤ SQL ‚Äî —ç—Ç–æ —Å–ª–æ–º–∞–µ—Ç —Ä–∞–±–æ—Ç—É Django.