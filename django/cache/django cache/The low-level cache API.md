## –ß—Ç–æ —Ç–∞–∫–æ–µ low-level cache API?

–≠—Ç–æ **–ø—Ä—è–º–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∫—ç—à—É**, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π **–∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –ª—é–±—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–µ —Ç–æ–ª—å–∫–æ HTTP-–æ—Ç–≤–µ—Ç—ã)** —Å **–ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–π –≥—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—å—é**.

‚Üí –¢—ã —Å–∞–º —Ä–µ—à–∞–µ—à—å:

- **—á—Ç–æ** –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å (—Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞, —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤, —á–∏—Å–ª–æ),
- **–Ω–∞ —Å–∫–æ–ª—å–∫–æ** (—Ç–∞–π–º–∞—É—Ç),
- **–ø–æ–¥ –∫–∞–∫–∏–º –∫–ª—é—á–æ–º**.

## –û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

### 1. `from django.core.cache import cache`

‚Äî **—è—Ä–ª—ã–∫ –¥–ª—è –∫—ç—à–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** (`CACHES["default"]`).
```python
from django.core.cache import cache

cache.set("my_key", {"data": 123}, timeout=300)
value = cache.get("my_key")
```
### 2. `from django.core.cache import caches`
‚Äî –¥–æ—Å—Ç—É–ø –∫ **–ª—é–±–æ–º—É –∫—ç—à—É** –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫.
```python
from django.core.cache import caches

redis_cache = caches["redis_fast"]
redis_cache.set("temp_data", [1, 2, 3])
```
‚úÖ –û–±–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ **–ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã**.  
‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤ `caches["name"]` –≤ –æ–¥–Ω–æ–º –ø–æ—Ç–æ–∫–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **—Ç–æ—Ç –∂–µ –æ–±—ä–µ–∫—Ç**.

## –ß—Ç–æ –º–æ–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å?

–õ—é–±–æ–π Python-–æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ **—Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ `pickle`**:

- `str`, `int`, `float`, `bool`, `None`
- `list`, `dict`, `tuple`
- —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –∫–ª–∞—Å—Å–æ–≤ (–≤–∫–ª—é—á–∞—è –º–æ–¥–µ–ª–∏ Django)
```python
# –ú–æ–∂–Ω–æ
cache.set("user_ids", [1, 2, 3])
cache.set("stats", {"visits": 100, "sales": 10})

# –ú–æ–∂–Ω–æ, –Ω–æ –û–ü–ê–°–ù–û (—Å–º. –Ω–∏–∂–µ)
cache.set("user_obj", User.objects.get(id=1))
```
‚ö†Ô∏è **–ù–µ –∫—ç—à–∏—Ä—É–π –º–æ–¥–µ–ª–∏ Django** ‚Äî –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–π `pickle` —Å–ª–æ–º–∞–µ—Ç—Å—è.  
‚úÖ –í—Å–µ–≥–¥–∞ –∫—ç—à–∏—Ä—É–π **—Å–ª–æ–≤–∞—Ä–∏ –∏–ª–∏ –ø—Ä–æ—Å—Ç—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã**.

## –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã

| –ú–µ—Ç–æ–¥                                     | –û–ø–∏—Å–∞–Ω–∏–µ                           |
| ----------------------------------------- | ---------------------------------- |
| `cache.set(key, value, timeout=300)`      | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ                 |
| `cache.get(key, default=None)`            | –ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ (–∏–ª–∏ `default`)  |
| `cache.delete(key)`                       | –£–¥–∞–ª–∏—Ç—å –∫–ª—é—á                       |
| `cache.add(key, value, timeout)`          | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–ª—é—á–∞ –Ω–µ—Ç   |
| `cache.get_or_set(key, default, timeout)` | –ü–æ–ª—É—á–∏—Ç—å –∏–ª–∏ –≤—ã—á–∏—Å–ª–∏—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å |
## ‚úÖ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

| –°—Ü–µ–Ω–∞—Ä–∏–π                                 | –†–µ—à–µ–Ω–∏–µ                        |
| ---------------------------------------- | ------------------------------ |
| –¢—è–∂—ë–ª—ã–π —Ä–∞—Å—á—ë—Ç, —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–µ–¥–∫–æ –º–µ–Ω—è–µ—Ç—Å—è | –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞–ø—Ä—è–º—É—é  |
| –ù–µ—Å–∫–æ–ª—å–∫–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö —Å —Ä–∞–∑–Ω—ã–º TTL | –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –æ—Ç–¥–µ–ª—å–Ω–æ     |
| –î–∞–Ω–Ω—ã–µ –¥–ª—è API-–æ—Ç–≤–µ—Ç–∞                    | –°–æ–±—Ä–∞—Ç—å –∏–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —á–∞—Å—Ç–µ–π |
| –°—á—ë—Ç—á–∏–∫–∏, —Ä–µ–π—Ç-–ª–∏–º–∏—Ç—ã                    | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `cache.incr()`    |
### –ü—Ä–∏–º–µ—Ä: —Ä–∞–∑–Ω—ã–µ TTL –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```python
def get_dashboard_data(user_id):
    # –†–µ–¥–∫–æ –º–µ–Ω—è—é—â–∏–µ—Å—è –¥–∞–Ω–Ω—ã–µ ‚Äî 1 —á–∞—Å
    profile = cache.get(f"profile_{user_id}")
    if profile is None:
        profile = fetch_profile(user_id)
        cache.set(f"profile_{user_id}", profile, timeout=3600)

    # –ß–∞—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º—ã–µ ‚Äî 30 —Å–µ–∫—É–Ω–¥
    stats = cache.get(f"stats_{user_id}")
    if stats is None:
        stats = fetch_realtime_stats(user_id)
        cache.set(f"stats_{user_id}", stats, timeout=30)

    return {"profile": profile, "stats": stats}
```
## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã

### 1. **–ò—Å–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–µ –∫—ç—à–∞**

–ï—Å–ª–∏ –∫—ç—à –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (Redis —É–ø–∞–ª), **Django –Ω–µ –ø–∞–¥–∞–µ—Ç** ‚Äî –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `None` (–∏–ª–∏ `default`).

‚Üí –ö—ç—à **–≤—Å–µ–≥–¥–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º —É—Å–∫–æ—Ä–∏—Ç–µ–ª–µ–º**, –∞ –Ω–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∏—Å—Ç–∏–Ω—ã.

### 2. **–ò–º–µ–Ω–∞ –∫–ª—é—á–µ–π ‚Äî —Å—Ç—Ä–æ–∫–∞**

–ö–ª—é—á –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **—É–Ω–∏–∫–∞–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π**:
```python
key = f"user_profile_v2:{user_id}:{lang}"
```
### 3. **–ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏**

–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å ‚Äî **—Å–∞–º –≤—ã–∑—ã–≤–∞–π `cache.delete()`**:
```python
def update_user(user_id, data):
    # –û–±–Ω–æ–≤–ª—è–µ–º –≤ –ë–î
    User.objects.filter(id=user_id).update(**data)
    # –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º –∫—ç—à
    cache.delete(f"profile_{user_id}")
```
## –°–æ–≤–µ—Ç—ã –¥–ª—è –¥–∂—É–Ω–∏–æ—Ä–∞

- **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π low-level API**, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å **–¥–∞–Ω–Ω—ã–µ, –∞ –Ω–µ HTML**.
- **–ù–µ –∫—ç—à–∏—Ä—É–π –º–æ–¥–µ–ª–∏** ‚Äî —Ç–æ–ª—å–∫–æ —Å–ª–æ–≤–∞—Ä–∏.
- **–í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π `timeout`** ‚Äî –∏–∑–±–µ–≥–∞–π ¬´–≤–µ—á–Ω–æ–≥–æ¬ª –∫—ç—à–∞.
- **–ò—Å–ø–æ–ª—å–∑—É–π `cache.get_or_set()`** –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è/—É—Å—Ç–∞–Ω–æ–≤–∫–∏.

---

## üíé –í—ã–≤–æ–¥

> **Low-level cache API ‚Äî —ç—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö.**  
> Per-site –∏ per-view –∫—ç—à ‚Äî –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤.  
> –ê **–Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π API** ‚Äî –¥–ª—è **–≥–∏–±–∫–æ—Å—Ç–∏, –∫–æ–Ω—Ç—Ä–æ–ª—è –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**.